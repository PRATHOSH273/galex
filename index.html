<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Galex Premium - Music Player</title>
<link rel="icon" src="logo.png">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
:root {
    --galex-blue: #1d51b9;
    --galex-light-blue: #1eafd7;
    --galex-purple: #8a2be2;
    --galex-dark: #0a0a0f;
    --galex-card: #141420;
    --galex-gray: #a0a0c0;
    --galex-light-gray: #2a2a3a;
    --galex-white: #ffffff;
    --galex-gradient: linear-gradient(135deg, var(--galex-blue), var(--galex-purple));
    --transition-speed: 0.4s;
    --border-radius: 16px;
    --border-radius-lg: 24px;
    --border-radius-sm: 12px;
    --player-height: 100px;
    --sidebar-width: 300px;
    --shadow-lg: 0 20px 60px rgba(0, 0, 0, 0.3);
    --shadow-md: 0 10px 30px rgba(0, 0, 0, 0.2);
    --shadow-sm: 0 5px 15px rgba(0, 0, 0, 0.1);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
}

body {
    background: var(--galex-dark);
    color: var(--galex-white);
    height: 100vh;
    overflow: hidden;
    font-weight: 400;
}

.animated-background {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: 
        radial-gradient(circle at 10% 20%, rgba(29, 81, 185, 0.15) 0%, transparent 20%),
        radial-gradient(circle at 90% 80%, rgba(138, 43, 226, 0.1) 0%, transparent 20%),
        linear-gradient(180deg, #0a0a0f 0%, #151522 100%);
    z-index: -2;
    animation: gradientShift 20s ease infinite alternate;
}

@keyframes gradientShift {
    0% { filter: hue-rotate(0deg); }
    100% { filter: hue-rotate(360deg); }
}

.background-particles {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    overflow: hidden;
}

.particle {
    position: absolute;
    background: var(--galex-blue);
    border-radius: 50%;
    opacity: 0.1;
    animation: float 15s infinite linear;
}

.particle:nth-child(odd) {
    background: var(--galex-purple);
}

@keyframes float {
    0% { transform: translateY(0) rotate(0deg); }
    100% { transform: translateY(-100vh) rotate(360deg); }
}

/* Layout */
.app-container {
    display: flex;
    height: 100vh;
    gap: 2px;
    padding: 20px;
    background: #00000000;
}

.sidebar {
    width: var(--sidebar-width);
    background: rgba(20, 20, 32, 0.85);
    backdrop-filter: blur(20px);
    border-radius: var(--border-radius-lg);
    display: flex;
    flex-direction: column;
    padding: 28px 16px;
    border: 1px solid rgba(255, 255, 255, 0.08);
    box-shadow: var(--shadow-lg);
    z-index: 10;
}

.logo {
    padding: 0 16px 32px;
    display: flex;
    align-items: center;
    gap: 14px;
    transition: transform var(--transition-speed) ease;
}

.logo:hover {
    transform: scale(1.02);
}

.logo-icon {
    font-size: 40px;
    background: var(--galex-gradient);
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    font-weight: 900;
    filter: drop-shadow(0 4px 8px rgba(29, 81, 185, 0.3));
    animation: logoPulse 3s ease-in-out infinite;
}

@keyframes logoPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

.logo-text {
    font-size: 32px;
    font-weight: 900;
    letter-spacing: -1.2px;
    background: var(--galex-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    text-shadow: 0 4px 12px rgba(29, 81, 185, 0.4);
}

.nav-section {
    margin-bottom: 40px;
}

.nav-menu {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.nav-item {
    display: flex;
    align-items: center;
    gap: 18px;
    padding: 16px 20px;
    border-radius: var(--border-radius);
    cursor: pointer;
    transition: all var(--transition-speed) cubic-bezier(0.4, 0, 0.2, 1);
    color: var(--galex-gray);
    font-size: 15px;
    font-weight: 500;
    position: relative;
    overflow: hidden;
}

.nav-item::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    width: 4px;
    height: 100%;
    background: var(--galex-gradient);
    transform: scaleY(0);
    transition: transform var(--transition-speed) ease;
}

.nav-item:hover {
    background: rgba(255, 255, 255, 0.05);
    color: var(--galex-white);
    padding-left: 28px;
    transform: translateX(5px);
}

.nav-item:hover::before {
    transform: scaleY(1);
}

.nav-item.active {
    background: rgba(255, 255, 255, 0.08);
    color: var(--galex-white);
    padding-left: 28px;
}

.nav-item.active::before {
    transform: scaleY(1);
}

.nav-icon {
    font-size: 22px;
    width: 28px;
    text-align: center;
    transition: transform var(--transition-speed) ease;
}

.nav-item:hover .nav-icon {
    transform: scale(1.2);
}

.main-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    background: rgba(20, 20, 32, 0.85);
    backdrop-filter: blur(20px);
    border-radius: var(--border-radius-lg);
    border: 1px solid rgba(255, 255, 255, 0.08);
    box-shadow: var(--shadow-lg);
}

/* Enhanced Top Bar */
.top-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 24px 40px;
    background: transparent;
    border-bottom: 1px solid rgba(255, 255, 255, 0.08);
}

.nav-controls {
    display: flex;
    gap: 16px;
}

.nav-btn {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: var(--galex-white);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all var(--transition-speed) cubic-bezier(0.4, 0, 0.2, 1);
    font-size: 18px;
}

.nav-btn:hover {
    background: var(--galex-gradient);
    transform: translateY(-2px) scale(1.1);
    box-shadow: var(--shadow-md);
}

.search-container {
    position: relative;
    width: 360px;
}

.search-input {
    width: 100%;
    padding: 14px 20px 14px 56px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 50px;
    color: var(--galex-white);
    font-size: 15px;
    outline: none;
    transition: all var(--transition-speed) ease;
}

.search-input:focus {
    background: rgba(255, 255, 255, 0.08);
    border-color: var(--galex-blue);
    box-shadow: 0 0 0 3px rgba(29, 81, 185, 0.2);
}

.search-icon {
    position: absolute;
    left: 20px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--galex-gray);
    font-size: 16px;
    transition: color var(--transition-speed) ease;
}

.search-input:focus + .search-icon {
    color: var(--galex-blue);
}

.user-profile {
    display: flex;
    align-items: center;
    gap: 14px;
    padding: 10px 20px 10px 14px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 50px;
    cursor: pointer;
    transition: all var(--transition-speed) ease;
}

.user-profile:hover {
    background: rgba(255, 255, 255, 0.08);
    transform: translateY(-2px);
    box-shadow: var(--shadow-sm);
}

.user-avatar {
    width: 40px;
    height: 40px;
    background: var(--galex-gradient);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 16px;
    color: var(--galex-white);
    transition: transform var(--transition-speed) ease;
}

.user-profile:hover .user-avatar {
    transform: rotate(15deg) scale(1.1);
}

/* Enhanced Now Playing Section */
.now-playing {
    flex: 1;
    padding: 40px;
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: var(--galex-blue) transparent;
}

.now-playing::-webkit-scrollbar {
    width: 8px;
}

.now-playing::-webkit-scrollbar-track {
    background: transparent;
}

.now-playing::-webkit-scrollbar-thumb {
    background: var(--galex-blue);
    border-radius: 4px;
}

.now-playing-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 40px;
}

.now-playing-header h2 {
    font-size: 36px;
    font-weight: 900;
    background: var(--galex-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    display: flex;
    align-items: center;
    gap: 16px;
}

.album-info {
    display: flex;
    align-items: flex-start;
    gap: 50px;
    margin-bottom: 50px;
}

.album-art-container {
    position: relative;
    width: 360px;
    height: 360px;
    border-radius: 50%;
    overflow: hidden;
    box-shadow: var(--shadow-lg);
    border: 4px solid transparent;
    background: var(--galex-gradient) border-box;
    animation: borderGlow 3s ease-in-out infinite;
}

@keyframes borderGlow {
    0%, 100% { box-shadow: 0 0 30px rgba(29, 81, 185, 0.5), var(--shadow-lg); }
    50% { box-shadow: 0 0 50px rgba(29, 81, 185, 0.8), var(--shadow-lg); }
}

.album-art {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 50%);
    transition: transform var(--transition-speed) ease;
}

.album-art:hover {
    transform: scale(1.02);
}

.album-details {
    flex: 1;
    padding-top: 20px;
}

.album-title {
    font-size: 80px;
    font-weight: 900;
    line-height: 1;
    margin-bottom: 24px;
    background: linear-gradient(135deg, #ffffff 0%, #a0a0c0 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    text-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
}

.album-stats {
    display: flex;
    gap: 40px;
    margin-bottom: 40px;
}

.stat-item {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.stat-label {
    font-size: 13px;
    color: var(--galex-gray);
    text-transform: uppercase;
    letter-spacing: 1px;
}

.stat-value {
    font-size: 28px;
    font-weight: 700;
    color: var(--galex-white);
    display: flex;
    align-items: center;
    gap: 10px;
}

/* Enhanced Playback Controls */
.playback-controls {
    padding: 24px 40px;
    background: linear-gradient(to bottom, transparent, rgba(10, 10, 15, 0.95) 30%);
    border-top: 1px solid rgba(255, 255, 255, 0.08);
}

.progress-container {
    display: flex;
    align-items: center;
    gap: 20px;
    margin-bottom: 24px;
}

.time-stamp {
    font-size: 15px;
    color: var(--galex-gray);
    min-width: 50px;
    font-weight: 500;
}

.progress-bar {
    flex: 1;
    height: 6px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 3px;
    position: relative;
    cursor: pointer;
    overflow: hidden;
    transition: height var(--transition-speed) ease;
}

.progress-bar:hover {
    height: 8px;
}

.progress-fill {
    position: absolute;
    height: 100%;
    background: var(--galex-gradient);
    border-radius: 3px;
    width: 0%;
    transition: width 0.1s linear;
    box-shadow: 0 0 10px rgba(29, 81, 185, 0.5);
}

.progress-handle {
    position: absolute;
    right: -6px;
    top: 50%;
    transform: translateY(-50%);
    width: 12px;
    height: 12px;
    background: var(--galex-white);
    border-radius: 50%;
    opacity: 0;
    transition: opacity var(--transition-speed) ease, transform var(--transition-speed) ease;
    box-shadow: 0 0 10px rgba(29, 81, 185, 0.8);
}

.progress-bar:hover .progress-handle {
    opacity: 1;
    transform: translateY(-50%) scale(1.2);
}

.controls-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 24px;
}

.controls-center {
    display: flex;
    align-items: center;
    gap: 32px;
}

.control-btn {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: var(--galex-gray);
    cursor: pointer;
    font-size: 20px;
    transition: all var(--transition-speed) cubic-bezier(0.4, 0, 0.2, 1);
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
}

.control-btn:hover {
    background: var(--galex-gradient);
    color: var(--galex-white);
    transform: translateY(-2px) scale(1.1);
    box-shadow: var(--shadow-md);
}

.control-btn.play-pause {
    width: 64px;
    height: 64px;
    background: var(--galex-gradient);
    color: var(--galex-white);
    border-radius: 50%;
    font-size: 24px;
    box-shadow: var(--shadow-md);
}

.control-btn.play-pause:hover {
    transform: translateY(-3px) scale(1.1);
    box-shadow: 0 15px 40px rgba(29, 81, 185, 0.4);
}

/* Enhanced Playlist */
.playlist-section {
    padding: 0 40px 40px;
}

.playlist-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 28px;
}

.playlist-header h3 {
    font-size: 28px;
    font-weight: 900;
    background: var(--galex-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.sort-options {
    display: flex;
    gap: 12px;
    background: rgba(255, 255, 255, 0.05);
    padding: 6px;
    border-radius: var(--border-radius);
}

.sort-btn {
    padding: 10px 20px;
    background: transparent;
    border: none;
    border-radius: var(--border-radius-sm);
    color: var(--galex-gray);
    font-size: 14px;
    cursor: pointer;
    transition: all var(--transition-speed) ease;
    font-weight: 500;
}

.sort-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    color: var(--galex-white);
    transform: translateY(-1px);
}

.sort-btn.active {
    background: var(--galex-gradient);
    color: var(--galex-white);
    font-weight: 600;
    box-shadow: var(--shadow-sm);
}

.playlist-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
}

.playlist-table th {
    text-align: left;
    padding: 18px 20px;
    font-size: 13px;
    color: var(--galex-gray);
    border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 1px;
    background: rgba(255, 255, 255, 0.03);
}

.playlist-table th:first-child {
    border-radius: var(--border-radius-sm) 0 0 0;
}

.playlist-table th:last-child {
    border-radius: 0 var(--border-radius-sm) 0 0;
}

.playlist-table td {
    padding: 18px 20px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    transition: all var(--transition-speed) ease;
}

.playlist-table tr {
    cursor: pointer;
    position: relative;
}

.playlist-table tr::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: var(--galex-gradient);
    opacity: 0;
    transition: opacity var(--transition-speed) ease;
    z-index: -1;
    border-radius: var(--border-radius-sm);
}

.playlist-table tr:hover::before {
    opacity: 0.05;
}

.playlist-table tr:hover td {
    transform: translateX(5px);
}

.playlist-table tr.active {
    background: rgba(29, 81, 185, 0.1);
}

.playlist-table tr.active::after {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    width: 4px;
    height: 100%;
    background: var(--galex-gradient);
    border-radius: 2px;
}

.track-number {
    width: 50px;
    text-align: center;
    font-size: 16px;
    color: var(--galex-gray);
    font-weight: 600;
}

.track-title {
    display: flex;
    align-items: center;
    gap: 16px;
}

.track-image {
    width: 50px;
    height: 50px;
    border-radius: var(--border-radius-sm);
    object-fit: cover;
    transition: transform var(--transition-speed) ease;
    box-shadow: var(--shadow-sm);
}

.playlist-table tr:hover .track-image {
    transform: scale(1.05) rotate(2deg);
}

.track-info {
    display: flex;
    flex-direction: column;
    gap: 6px;
}

.track-name {
    font-size: 16px;
    font-weight: 600;
}

.track-artist {
    font-size: 14px;
    color: var(--galex-gray);
}

.track-album {
    font-size: 14px;
    color: var(--galex-gray);
}

.track-year {
    width: 80px;
    font-size: 14px;
    color: var(--galex-gray);
    font-weight: 500;
}

.track-duration {
    width: 60px;
    font-size: 14px;
    color: var(--galex-gray);
    font-weight: 500;
}

.track-actions {
    width: 50px;
    text-align: center;
}

.action-btn {
    background: none;
    border: none;
    color: var(--galex-gray);
    cursor: pointer;
    font-size: 18px;
    transition: all var(--transition-speed) ease;
    width: 36px;
    height: 36px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
}

.action-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    color: var(--galex-blue);
    transform: scale(1.1);
}

/* Album Rotation Animation */
@keyframes albumRotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

.album-art.playing {
    animation: albumRotate 30s linear infinite;
}

.wave-animation {
    display: flex;
    align-items: center;
    gap: 6px;
    height: 24px;
}

.wave-bar {
    width: 4px;
    height: 100%;
    background: var(--galex-gradient);
    border-radius: 4px;
    animation: wave 1.2s ease-in-out infinite;
    transform-origin: bottom;
}

.wave-bar:nth-child(2) { animation-delay: -1.1s; }
.wave-bar:nth-child(3) { animation-delay: -1.0s; }
.wave-bar:nth-child(4) { animation-delay: -0.9s; }
.wave-bar:nth-child(5) { animation-delay: -0.8s; }

@keyframes wave {
    0%, 100% { transform: scaleY(0.3); }
    50% { transform: scaleY(1); }
}

/* Enhanced Toast Notification */
.toast {
    position: fixed;
    bottom: 120px;
    left: 50%;
    transform: translateX(-50%) translateY(100px);
    background: var(--galex-gradient);
    color: var(--galex-white);
    padding: 16px 28px;
    border-radius: var(--border-radius);
    font-weight: 600;
    font-size: 15px;
    z-index: 10000;
    opacity: 0;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: var(--shadow-lg);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    align-items: center;
    gap: 12px;
    max-width: 400px;
}

.toast::before {
    content: '\f0e0';
    font-family: 'Font Awesome 6 Free';
    font-weight: 900;
    font-size: 18px;
}

.toast.show {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
}

.toast.success {
    background: linear-gradient(135deg, #10b981, #059669);
}

.toast.error {
    background: linear-gradient(135deg, #ef4444, #dc2626);
}

.spotify-badge {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    background: #1DB954;
    color: white;
    padding: 6px 14px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 700;
    margin-left: 10px;
    vertical-align: middle;
    box-shadow: 0 4px 12px rgba(29, 185, 84, 0.3);
    animation: badgePulse 2s ease-in-out infinite;
}

@keyframes badgePulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

/* Loading Animation */
.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--galex-dark);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    transition: opacity 0.5s ease;
}

.loading-spinner {
    width: 60px;
    height: 60px;
    border: 4px solid rgba(255, 255, 255, 0.1);
    border-top-color: var(--galex-blue);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-bottom: 20px;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* Volume Control */
.volume-control {
    display: flex;
    align-items: center;
    gap: 12px;
    width: 160px;
}

.volume-slider {
    flex: 1;
    height: 4px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 2px;
    position: relative;
    cursor: pointer;
}

.volume-level {
    position: absolute;
    height: 100%;
    background: var(--galex-gradient);
    border-radius: 2px;
    width: 70%;
}

@media (max-width: 1400px) {
    .album-title {
        font-size: 64px;
    }
    
    .album-art-container {
        width: 320px;
        height: 320px;
    }
    
    .sidebar {
        width: 280px;
    }
}

@media (max-width: 1200px) {
    .album-title {
        font-size: 56px;
    }
    
    .album-art-container {
        width: 280px;
        height: 280px;
    }
    
    .album-stats {
        flex-direction: column;
        gap: 24px;
    }
    
    .now-playing {
        padding: 32px;
    }
}

@media (max-width: 992px) {
    .app-container {
        flex-direction: column;
        padding: 16px;
    }
    
    .sidebar {
        width: 100%;
        flex-direction: row;
        padding: 20px;
        margin-bottom: 16px;
    }
    
    .logo {
        padding: 0;
        margin-right: 40px;
    }
    
    .nav-menu {
        flex-direction: row;
        gap: 4px;
    }
    
    .nav-item {
        padding: 12px 16px;
        font-size: 14px;
    }
    
    .nav-item span {
        display: none;
    }
    
    .album-info {
        flex-direction: column;
        align-items: center;
        text-align: center;
    }
    
    .album-details {
        width: 100%;
    }
    
    .controls-row {
        flex-wrap: wrap;
        justify-content: center;
    }
    
    .volume-control {
        width: 100%;
        justify-content: center;
        margin-top: 16px;
    }
}

@media (max-width: 768px) {
    .top-bar {
        padding: 20px;
        flex-wrap: wrap;
        gap: 16px;
    }
    
    .search-container {
        width: 100%;
        order: 3;
    }
    
    .now-playing {
        padding: 24px;
    }
    
    .album-title {
        font-size: 40px;
    }
    
    .album-art-container {
        width: 240px;
        height: 240px;
        border-radius: 50%;
    }
    
    .playlist-table {
        display: block;
        overflow-x: auto;
    }
    
    .playlist-header {
        flex-direction: column;
        gap: 16px;
        align-items: flex-start;
    }
    
    .sort-options {
        width: 100%;
        justify-content: center;
    }
}

@media (max-width: 480px) {
    .album-title {
        font-size: 32px;
    }
    
    .album-art-container {
        width: 200px;
        height: 200px;
    }
    
    .stat-value {
        font-size: 22px;
    }
    
    .controls-center {
        gap: 16px;
    }
    
    .control-btn.play-pause {
        width: 56px;
        height: 56px;
    }
}

.context-menu {
    position: fixed;
    background: rgba(30, 30, 45, 0.95);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: var(--border-radius);
    padding: 8px 0;
    box-shadow: var(--shadow-lg);
    z-index: 1000;
    min-width: 200px;
    opacity: 0;
    transform: scale(0.95);
    transition: all 0.2s ease;
}

.context-menu.show {
    opacity: 1;
    transform: scale(1);
}

.context-item {
    padding: 12px 20px;
    color: var(--galex-gray);
    cursor: pointer;
    transition: all var(--transition-speed) ease;
    display: flex;
    align-items: center;
    gap: 12px;
    font-size: 14px;
}

.context-item:hover {
    background: rgba(255, 255, 255, 0.05);
    color: var(--galex-white);
    padding-left: 24px;
}

.hover-lift {
    transition: transform var(--transition-speed) ease;
}

.hover-lift:hover {
    transform: translateY(-4px);
}

.glass {
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.fab {
    position: fixed;
    bottom: 30px;
    right: 30px;
    width: 60px;
    height: 60px;
    background: var(--galex-gradient);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 24px;
    cursor: pointer;
    box-shadow: var(--shadow-lg);
    transition: all var(--transition-speed) ease;
    z-index: 100;
}

.fab:hover {
    transform: scale(1.1) rotate(90deg);
    box-shadow: 0 20px 40px rgba(29, 81, 185, 0.4);
}
</style>
</head>
<body>
<div class="animated-background"></div>
<div class="background-particles" id="particlesContainer"></div>

<div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
    <h3 style="color: var(--galex-white); font-weight: 600;">Loading Galex Premium...</h3>
</div>

<div class="app-container">
    <div class="sidebar">
        <div class="logo">
            <div class="logo-icon">G</div>
            <div class="logo-text">Galex</div>
        </div>
        
        <div class="nav-section">
            <div class="nav-menu">
                <div class="nav-item active">
                    <div class="nav-icon"><i class="fas fa-home"></i></div>
                    <span>Home</span>
                </div>
                <div class="nav-item">
                    <div class="nav-icon"><i class="fas fa-search"></i></div>
                    <span>Search</span>
                </div>
                <div class="nav-item">
                    <div class="nav-icon"><i class="fas fa-book"></i></div>
                    <span>Library</span>
                </div>
                <div class="nav-item" id="spotifyConnectBtn">
                    <div class="nav-icon"><i class="fab fa-spotify"></i></div>
                    <span>Connect Spotify</span>
                </div>
            </div>
        </div>
    </div>
    
    <div class="main-content">
        <div class="top-bar">
            <div class="nav-controls">
                <button class="nav-btn hover-lift" onclick="prevSong()">
                    <i class="fas fa-step-backward"></i>
                </button>
                <button class="nav-btn hover-lift" onclick="nextSong()">
                    <i class="fas fa-step-forward"></i>
                </button>
            </div>
            
            <div class="search-container">
                <div class="search-icon">
                    <i class="fas fa-search"></i>
                </div>
                <input type="text" class="search-input" placeholder="Search songs, artists, or albums" 
                       oninput="filterSongs(this.value)" id="searchInput">
            </div>
            
            <div class="user-profile hover-lift" id="userProfile">
                <div class="user-avatar" id="userAvatar">U</div>
                <span class="username" id="username">User</span>
            </div>
        </div>
        
        <div class="now-playing">
            <div class="now-playing-header">
                <h2>
                    <i class="fas fa-music"></i>
                    Now Playing
                </h2>
                <div class="wave-animation" id="waveAnimation" style="display: none;">
                    <div class="wave-bar"></div>
                    <div class="wave-bar"></div>
                    <div class="wave-bar"></div>
                    <div class="wave-bar"></div>
                    <div class="wave-bar"></div>
                </div>
            </div>
            
            <div class="album-info">
                <div class="album-art-container">
                    <img id="songImg" class="album-art" src="https://th.bing.com/th/id/OIP.3pJ7dpx_ajr_3Qm0WdOG2QHaFj?w=233&h=180" alt="Album Art">
                </div>
                
                <div class="album-details">
                    <h1 class="album-title" id="songName">Song Name</h1>
                    
                    <div class="album-stats">
                        <div class="stat-item">
                            <div class="stat-label">Artist</div>
                            <div class="stat-value">
                                <i class="fas fa-user"></i>
                                <span id="artistName">Artist</span>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Music Director</div>
                            <div class="stat-value">
                                <i class="fas fa-compact-disc"></i>
                                <span id="musicDirector">Director</span>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Year</div>
                            <div class="stat-value">
                                <i class="fas fa-calendar"></i>
                                <span id="songYear">2024</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="playlist-section">
                <div class="playlist-header">
                    <h3>
                        <i class="fas fa-list-music"></i>
                        Playlist
                    </h3>
                    <div class="sort-options">
                        <button class="sort-btn" onclick="sortSongs('name')">Title</button>
                        <button class="sort-btn" onclick="sortSongs('year')">Year</button>
                        <button class="sort-btn active" onclick="sortSongs('artist')">Artist</button>
                        <button class="sort-btn" onclick="sortSongs('music')">Director</button>
                    </div>
                </div>
                
                <table class="playlist-table" id="playlistTable">
                    <thead>
                        <tr>
                            <th style="width: 50px;">#</th>
                            <th>Title</th>
                            <th>Album</th>
                            <th style="width: 100px;">Year</th>
                            <th style="width: 80px;"><i class="far fa-clock"></i></th>
                            <th style="width: 50px;"></th>
                        </tr>
                    </thead>
                    <tbody id="songList">
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="playback-controls">
            <div class="progress-container">
                <span class="time-stamp" id="currentTime">0:00</span>
                <div class="progress-bar" id="progressBar">
                    <div class="progress-fill" id="progressFill">
                        <div class="progress-handle"></div>
                    </div>
                </div>
                <span class="time-stamp" id="duration">0:00</span>
            </div>
            
            <div class="controls-row">
                <div class="controls-center">
                    <button class="control-btn hover-lift" onclick="prevSong()" title="Previous">
                        <i class="fas fa-step-backward"></i>
                    </button>
                    <button class="control-btn play-pause hover-lift" onclick="playPause()" id="playBtn" title="Play/Pause">
                        <i class="fas fa-play"></i>
                    </button>
                    <button class="control-btn hover-lift" onclick="nextSong()" title="Next">
                        <i class="fas fa-step-forward"></i>
                    </button>
                </div>
                
                <div class="volume-control">
                    <i class="fas fa-volume-up" style="color: var(--galex-gray);"></i>
                    <div class="volume-slider" id="volumeSlider">
                        <div class="volume-level" id="volumeLevel"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="toast" id="toast"></div>

<div class="context-menu" id="contextMenu">
    <div class="context-item" onclick="addToQueue()">
        <i class="fas fa-plus"></i>
        <span>Add to Queue</span>
    </div>
    <div class="context-item" onclick="addToPlaylist()">
        <i class="fas fa-list-music"></i>
        <span>Add to Playlist</span>
    </div>
    <div class="context-item" onclick="shareSong()">
        <i class="fas fa-share"></i>
        <span>Share</span>
    </div>
</div>
<div class="fab" id="floatingActionBtn" onclick="showQuickActions()">
    <i class="fas fa-plus"></i>
</div>

<script>
const playlist = [
    {
        src: "Aagaya Suriyanai - Harish Raghavendra, Harini.mp3",
        img: "https://imgs.search.brave.com/Q5zayQ_Cu-59A30OLKV506-l6o8-HsCbHYVzO7UN9wA/rs:fit:500:0:1:0/g:ce/aHR0cHM6Ly9tLm1l/ZGlhLWFtYXpvbi5j/b20vaW1hZ2VzL00v/TVY1Qk9XVXlORE15/WlRndE5HUTNOeTAw/TkRRd0xUaG1ZVGt0/TWpsa1kySmxORGcz/WTJabFhrRXlYa0Zx/Y0djQC5qcGc",
        name: "Aagaya Suriyanai",
        album: "Album One",
        year: 2002,
        music: "Harris Jayaraj",
        artist: "Harish Raghavendra",
        duration: "3:45"
    },
    {
        src: "Aaha Kalyanam - From  Petta  - Anthony Daasan.mp3",
        img: "https://imgs.search.brave.com/DBWnzWSsMXVy4ffTIUeaob65Eo0sRkAERsQs6rO3Jgg/rs:fit:860:0:0:0/g:ce/aHR0cHM6Ly9jLnNh/YXZuY2RuLmNvbS9h/cnRpc3RzL0FuaXJ1/ZGhfUmF2aWNoYW5k/ZXJfMDAyXzIwMjQw/MTAzMDY0NTU4XzUw/MHg1MDAuanBn",
        name: "Aaha Kalyanam",
        album: "Petta (Original Motion Picture Soundtrack)",
        year: 2019,
        music: "Anirudh",
        artist: "Anthony Daasan",
        duration: "4:20"
    },
    {
        src: "Aai Mailapuru - Srikanth Deva, Manikka Vinayagam, Sabesh, Ganga, Suchitra.mp3",
        img: "https://th.bing.com/th/id/OIP._O5RxCytnC2wEs91vkjlpgHaEK?w=266&h=180",
        name: "Aai Mailapuru",
        album: "Classical Collection",
        year: 2004,
        music: "Srikanth Deva",
        artist: "Manikka Vinayagam",
        duration: "5:10"
    },
    {
        src: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3",
        img: "https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        name: "Melody Waves",
        album: "Modern Vibes",
        year: 2020,
        music: "Yuvan Shankar",
        artist: "Sid Sriram",
        duration: "4:05"
    },
    {
        src: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3",
        img: "https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        name: "Rhythm Divine",
        album: "Eternal Beats",
        year: 2018,
        music: "A.R. Rahman",
        artist: "Shreya Ghoshal",
        duration: "3:55"
    },
    {
        src: "Aala Asatthum - S. P. Balasubrahmanyam, Vani Jairam.mp3",
        img: "https://imgs.search.brave.com/HLoz5a15uQERXDF1cuqlE50fu_VcG-IHHslmaQV1PnA/rs:fit:500:0:1:0/g:ce/aHR0cHM6Ly9tZWRp/YS5pbnNpZGVyLmlu/L2ltYWdlL3VwbG9h/ZC9jX2Nyb3AsZ19j/dXN0b20vdjE3MzIx/Njc0ODgvY2t4cWlv/bngzN3NiOHF2d2tp/enkuanBn",
        name: "Aala Asatthum",
        album: "Kanni Rasi",
        year: 1985,
        music: "Ilaiyaraaja",
        artist: "S. P. Balasubrahmanyam",
        duration: "4:30"
    },
    {
        src: "Aaluma Doluma - Anirudh Ravichander, Badshah.mp3",
        img: "https://images.unsplash.com/photo-1470225620780-dba8ba36b745?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        name: "Aaluma Doluma",
        album: "vethalam",
        year: 2015,
        music: "Anirudh Ravichander",
        artist: "Anirudh Ravichander",
        duration: "4:30"
    },
    {
        src: "Aariya Udhadugal - Hariharan, Swarnalatha.mp3",
        img: "https://images.unsplash.com/photo-1470225620780-dba8ba36b745?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        name: "Aariya Udhadugal",
        album: "Chellamae",
        year: 2004,
        music: "Harris Jayaraj",
        artist: "Hariharan, Swarnalatha",
        duration: "4:30"
    }
];

const SPOTIFY_CONFIG = {
    clientId: 'YOUR_SPOTIFY_CLIENT_ID_HERE',
    redirectUri: window.location.origin + '/callback',
    scopes: [
        'user-read-private',
        'user-read-email',
        'user-read-playback-state',
        'user-modify-playback-state',
        'user-read-currently-playing',
        'streaming',
        'playlist-read-private',
        'playlist-read-collaborative'
    ].join(' ')
};

let audio = new Audio();
let currentIndex = 0;
let filteredSongs = [...playlist];
let isPlaying = false;
let spotifyToken = null;
let spotifyPlayer = null;
let isSpotifyConnected = false;
let spotifyDeviceId = null;
let volume = 0.7;
let queue = [];
let favorites = new Set();

const elements = {
    songImg: document.getElementById('songImg'),
    songName: document.getElementById('songName'),
    artistName: document.getElementById('artistName'),
    musicDirector: document.getElementById('musicDirector'),
    songYear: document.getElementById('songYear'),
    currentTime: document.getElementById('currentTime'),
    duration: document.getElementById('duration'),
    progressBar: document.getElementById('progressBar'),
    progressFill: document.getElementById('progressFill'),
    playBtn: document.getElementById('playBtn'),
    songList: document.getElementById('songList'),
    waveAnimation: document.getElementById('waveAnimation'),
    toast: document.getElementById('toast'),
    searchInput: document.getElementById('searchInput'),
    userAvatar: document.getElementById('userAvatar'),
    username: document.getElementById('username'),
    spotifyConnectBtn: document.getElementById('spotifyConnectBtn'),
    volumeSlider: document.getElementById('volumeSlider'),
    volumeLevel: document.getElementById('volumeLevel'),
    loadingOverlay: document.getElementById('loadingOverlay'),
    contextMenu: document.getElementById('contextMenu'),
    particlesContainer: document.getElementById('particlesContainer'),
    floatingActionBtn: document.getElementById('floatingActionBtn')
};

function createParticles() {
    for (let i = 0; i < 30; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.width = Math.random() * 100 + 50 + 'px';
        particle.style.height = particle.style.width;
        particle.style.left = Math.random() * 100 + 'vw';
        particle.style.top = Math.random() * 100 + 'vh';
        particle.style.animationDelay = Math.random() * 15 + 's';
        particle.style.animationDuration = Math.random() * 10 + 10 + 's';
        elements.particlesContainer.appendChild(particle);
    }
}

function hideLoading() {
    setTimeout(() => {
        elements.loadingOverlay.style.opacity = '0';
        setTimeout(() => {
            elements.loadingOverlay.style.display = 'none';
        }, 500);
    }, 1000);
}
function showContextMenu(x, y, songIndex) {
    elements.contextMenu.style.left = x + 'px';
    elements.contextMenu.style.top = y + 'px';
    elements.contextMenu.classList.add('show');
    elements.contextMenu.dataset.songIndex = songIndex;
}

function hideContextMenu() {
    elements.contextMenu.classList.remove('show');
}

function addToQueue() {
    const index = elements.contextMenu.dataset.songIndex;
    const song = filteredSongs[index];
    queue.push(song);
    showToast(`"${song.name}" added to queue`, 'success');
}

function addToPlaylist() {
    const index = elements.contextMenu.dataset.songIndex;
    const song = filteredSongs[index];
    showToast(`"${song.name}" added to playlist`, 'success');
}

function shareSong() {
    const index = elements.contextMenu.dataset.songIndex;
    const song = filteredSongs[index];
    if (navigator.share) {
        navigator.share({
            title: song.name,
            text: `Listen to ${song.name} by ${song.artist} on Galex Premium`,
            url: window.location.href
        });
    } else {
        navigator.clipboard.writeText(`${song.name} by ${song.artist}`);
        showToast('Link copied to clipboard!', 'success');
    }
}

function showQuickActions() {
    const actions = [
        { icon: 'fas fa-plus', label: 'Add Song', action: () => console.log('Add song') },
        { icon: 'fas fa-folder-plus', label: 'New Playlist', action: () => console.log('New playlist') },
        { icon: 'fas fa-download', label: 'Download', action: () => console.log('Download') },
        { icon: 'fas fa-share', label: 'Share', action: () => console.log('Share') }
    ];
    
    const menu = document.createElement('div');
    menu.className = 'context-menu';
    menu.style.bottom = '100px';
    menu.style.right = '30px';
    menu.style.left = 'auto';
    
    actions.forEach(action => {
        const item = document.createElement('div');
        item.className = 'context-item';
        item.innerHTML = `<i class="${action.icon}"></i><span>${action.label}</span>`;
        item.onclick = action.action;
        menu.appendChild(item);
    });
    
    document.body.appendChild(menu);
    menu.classList.add('show');
    
    setTimeout(() => {
        document.addEventListener('click', function hideMenu(e) {
            if (!menu.contains(e.target) && e.target !== elements.floatingActionBtn) {
                menu.classList.remove('show');
                setTimeout(() => menu.remove(), 200);
                document.removeEventListener('click', hideMenu);
            }
        });
    }, 100);
}

function setupVolumeControl() {
    elements.volumeSlider.addEventListener('click', (e) => {
        const rect = e.currentTarget.getBoundingClientRect();
        const percent = (e.clientX - rect.left) / rect.width;
        volume = Math.max(0, Math.min(1, percent));
        audio.volume = volume;
        elements.volumeLevel.style.width = `${volume * 100}%`;
        showToast(`Volume: ${Math.round(volume * 100)}%`);
    });
    
    audio.volume = volume;
    elements.volumeLevel.style.width = `${volume * 100}%`;
}

function initSpotify() {
    const script = document.createElement('script');
    script.src = 'https://sdk.scdn.co/spotify-player.js';
    script.async = true;
    document.head.appendChild(script);
    
    window.onSpotifyWebPlaybackSDKReady = () => {
        console.log('Spotify Web Playback SDK ready');
        const storedToken = localStorage.getItem('spotify_token');
        if (storedToken) {
            spotifyToken = storedToken;
            isSpotifyConnected = true;
            setupSpotifyPlayer(storedToken);
            updateConnectionStatus();
            showToast('Reconnected to Spotify', 'info');
        }
    };
}

function connectSpotify() {
    const authUrl = `https://accounts.spotify.com/authorize?response_type=token&client_id=${SPOTIFY_CONFIG.clientId}&scope=${encodeURIComponent(SPOTIFY_CONFIG.scopes)}&redirect_uri=${encodeURIComponent(SPOTIFY_CONFIG.redirectUri)}&show_dialog=true`;
    window.open(authUrl, 'Spotify Auth', 'width=600,height=700');
}

function handleSpotifyCallback() {
    const hash = window.location.hash.substring(1);
    const params = new URLSearchParams(hash);
    
    const token = params.get('access_token');
    if (token) {
        spotifyToken = token;
        isSpotifyConnected = true;
        localStorage.setItem('spotify_token', token);
        setupSpotifyPlayer(token);
        showToast('Successfully connected to Spotify!', 'success');
        updateConnectionStatus();
        
        window.history.replaceState({}, document.title, window.location.pathname);
    }
}

function setupSpotifyPlayer(token) {
    spotifyPlayer = new Spotify.Player({
        name: 'Galex Premium Player',
        getOAuthToken: cb => { cb(token); },
        volume: volume
    });

    spotifyPlayer.addListener('ready', ({ device_id }) => {
        console.log('Ready with Device ID', device_id);
        spotifyDeviceId = device_id;
        showToast('Spotify player ready', 'success');
    });

    spotifyPlayer.addListener('not_ready', ({ device_id }) => {
        console.log('Device ID has gone offline', device_id);
        spotifyDeviceId = null;
    });

    spotifyPlayer.addListener('initialization_error', ({ message }) => {
        console.error('Failed to initialize', message);
        showToast('Spotify player failed to initialize', 'error');
    });

    spotifyPlayer.addListener('authentication_error', ({ message }) => {
        console.error('Failed to authenticate', message);
        showToast('Spotify authentication failed', 'error');
        disconnectSpotify();
    });

    spotifyPlayer.addListener('account_error', ({ message }) => {
        console.error('Failed to validate Spotify account', message);
        showToast('Spotify account error', 'error');
    });

    spotifyPlayer.addListener('player_state_changed', state => {
        if (!state) return;
        
        const { track_window: { current_track }, paused, position, duration } = state;
        
        if (current_track) {
            updateNowPlayingUI(current_track);
            
            if (duration > 0) {
                const progress = (position / duration) * 100;
                elements.progressFill.style.width = `${progress}%`;
                elements.currentTime.textContent = formatTime(position / 1000);
                elements.duration.textContent = formatTime(duration / 1000);
            }
        }
        
        isPlaying = !paused;
        updatePlayButton();
    });

    spotifyPlayer.connect().then(success => {
        if (success) {
            console.log('Spotify player connected successfully');
        }
    });
}

function updateNowPlayingUI(track) {
    if (track) {
        elements.songImg.src = track.album.images[0]?.url || 'https://via.placeholder.com/300';
        elements.songName.textContent = track.name;
        elements.artistName.textContent = track.artists.map(a => a.name).join(', ');
        elements.musicDirector.textContent = 'Spotify';
        elements.songYear.textContent = new Date(track.album.release_date).getFullYear() || 'Unknown';
        
        if (isPlaying) {
            elements.songImg.classList.add('playing');
            elements.waveAnimation.style.display = 'flex';
        } else {
            elements.songImg.classList.remove('playing');
            elements.waveAnimation.style.display = 'none';
        }
    }
}

function playSpotifyTrack(spotifyUri) {
    if (!spotifyToken || !spotifyDeviceId) {
        showToast('Please connect to Spotify first', 'error');
        connectSpotify();
        return;
    }

    fetch(`https://api.spotify.com/v1/me/player/play?device_id=${spotifyDeviceId}`, {
        method: 'PUT',
        headers: {
            'Authorization': `Bearer ${spotifyToken}`,
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            uris: [spotifyUri]
        })
    }).then(response => {
        if (response.status === 404) {
            showToast('Device not found. Try reconnecting to Spotify.', 'error');
        } else if (response.ok) {
            showToast('Playing from Spotify', 'success');
            isPlaying = true;
            updatePlayButton();
        } else if (response.status === 403) {
            showToast('Spotify Premium required for playback', 'error');
        }
    }).catch(error => {
        console.error('Playback error:', error);
        showToast('Failed to play track', 'error');
    });
}

async function searchSpotify(query) {
    if (!spotifyToken) {
        showToast('Please connect to Spotify first', 'error');
        return [];
    }

    try {
        const response = await fetch(`https://api.spotify.com/v1/search?q=${encodeURIComponent(query)}&type=track&limit=10`, {
            headers: {
                'Authorization': `Bearer ${spotifyToken}`
            }
        });
        
        if (response.ok) {
            const data = await response.json();
            return data.tracks.items;
        } else if (response.status === 401) {
            disconnectSpotify();
            showToast('Spotify session expired. Please reconnect.', 'error');
        }
        return [];
    } catch (error) {
        console.error('Search error:', error);
        return [];
    }
}

function disconnectSpotify() {
    if (spotifyPlayer) {
        spotifyPlayer.disconnect();
    }
    spotifyToken = null;
    spotifyPlayer = null;
    isSpotifyConnected = false;
    spotifyDeviceId = null;
    localStorage.removeItem('spotify_token');
    updateConnectionStatus();
    showToast('Disconnected from Spotify', 'info');
}

function updateConnectionStatus() {
    if (isSpotifyConnected) {
        elements.userAvatar.innerHTML = '<i class="fab fa-spotify"></i>';
        elements.userAvatar.style.background = 'linear-gradient(135deg, #1DB954, #1ed760)';
        elements.username.textContent = 'Spotify';
        elements.spotifyConnectBtn.querySelector('span').textContent = 'Connected to Spotify';
        elements.spotifyConnectBtn.style.background = 'rgba(29, 185, 84, 0.1)';
    } else {
        elements.userAvatar.textContent = 'U';
        elements.userAvatar.style.background = 'var(--galex-gradient)';
        elements.username.textContent = 'User';
        elements.spotifyConnectBtn.querySelector('span').textContent = 'Connect Spotify';
        elements.spotifyConnectBtn.style.background = '';
    }
}


function initPlayer() {
    createParticles();
    loadSong(currentIndex);
    updatePlaylist();
    setupEventListeners();
    setupVolumeControl();
    showToast('Galex Premium Player Ready', 'success');
    initSpotify();
    handleSpotifyCallback();
    hideLoading();
}

function loadSong(index) {
    if (index < 0 || index >= filteredSongs.length) return;
    
    currentIndex = index;
    const song = filteredSongs[currentIndex];
    
    if (song.isSpotify) {
        playSpotifyTrack(song.src);
        
        elements.songImg.src = song.img;
        elements.songName.textContent = song.name;
        elements.artistName.textContent = song.artist;
        elements.musicDirector.textContent = song.music;
        elements.songYear.textContent = song.year;
        
        showToast(`Now Playing from Spotify: ${song.name}`, 'success');
    } else {
        audio.src = song.src;
        
        elements.songImg.src = song.img;
        elements.songName.textContent = song.name;
        elements.artistName.textContent = song.artist;
        elements.musicDirector.textContent = song.music;
        elements.songYear.textContent = song.year;
        
        elements.progressFill.style.width = '0%';
        elements.currentTime.textContent = '0:00';
        
        showToast(`Now Playing: ${song.name}`, 'success');
    }
    
    updatePlaylist();
}

function playPause() {
    if (isSpotifyConnected && spotifyPlayer) {
        spotifyPlayer.togglePlay().then(() => {
            isPlaying = !isPlaying;
            updatePlayButton();
        }).catch(error => {
            console.error('Spotify playback error:', error);
            playPauseLocal();
        });
    } else {
        playPauseLocal();
    }
}

function playPauseLocal() {
    if (audio.src) {
        if (isPlaying) {
            audio.pause();
            elements.playBtn.innerHTML = '<i class="fas fa-play"></i>';
            elements.songImg.classList.remove('playing');
            elements.waveAnimation.style.display = 'none';
        } else {
            audio.play().then(() => {
                elements.playBtn.innerHTML = '<i class="fas fa-pause"></i>';
                elements.songImg.classList.add('playing');
                elements.waveAnimation.style.display = 'flex';
            }).catch(e => {
                console.log('Playback failed:', e);
                showToast('Playback failed. Please check audio file.', 'error');
            });
        }
        isPlaying = !isPlaying;
    } else {
        loadSong(currentIndex);
        playPause();
    }
}

function updatePlayButton() {
    if (isPlaying) {
        elements.playBtn.innerHTML = '<i class="fas fa-pause"></i>';
        elements.waveAnimation.style.display = 'flex';
    } else {
        elements.playBtn.innerHTML = '<i class="fas fa-play"></i>';
        elements.waveAnimation.style.display = 'none';
    }
}

function nextSong() {
    if (filteredSongs.length === 0) return;
    
    currentIndex = (currentIndex + 1) % filteredSongs.length;
    loadSong(currentIndex);
    
    if (isPlaying) {
        if (filteredSongs[currentIndex].isSpotify) {
            // Spotify handles playback
        } else {
            audio.play().then(() => {
                elements.playBtn.innerHTML = '<i class="fas fa-pause"></i>';
                elements.songImg.classList.add('playing');
                elements.waveAnimation.style.display = 'flex';
            });
        }
    }
}

function prevSong() {
    if (filteredSongs.length === 0) return;
    
    if (!filteredSongs[currentIndex].isSpotify && audio.currentTime > 3) {
        audio.currentTime = 0;
        showToast('Restarted current song', 'info');
    } else {
        currentIndex = (currentIndex - 1 + filteredSongs.length) % filteredSongs.length;
        loadSong(currentIndex);
        
        if (isPlaying) {
            if (filteredSongs[currentIndex].isSpotify) {
                // Spotify handles playback
            } else {
                audio.play().then(() => {
                    elements.playBtn.innerHTML = '<i class="fas fa-pause"></i>';
                    elements.songImg.classList.add('playing');
                    elements.waveAnimation.style.display = 'flex';
                });
            }
        }
    }
}

function setupProgressBar() {
    audio.ontimeupdate = () => {
        if (audio.duration && !isNaN(audio.duration)) {
            const progress = (audio.currentTime / audio.duration) * 100;
            elements.progressFill.style.width = `${progress}%`;
            elements.currentTime.textContent = formatTime(audio.currentTime);
            elements.duration.textContent = formatTime(audio.duration);
        }
    };
    
    elements.progressBar.addEventListener('click', (e) => {
        if (isSpotifyConnected && spotifyPlayer) {
            showToast('Seek not available for Spotify Web Player', 'info');
            return;
        }
        
        const rect = e.currentTarget.getBoundingClientRect();
        const percent = (e.clientX - rect.left) / rect.width;
        if (audio.duration) {
            audio.currentTime = percent * audio.duration;
        }
    });
}

function formatTime(seconds) {
    if (isNaN(seconds)) return "0:00";
    const min = Math.floor(seconds / 60);
    const sec = Math.floor(seconds % 60);
    return `${min}:${sec < 10 ? '0' : ''}${sec}`;
}

function updatePlaylist() {
    elements.songList.innerHTML = '';
    
    filteredSongs.forEach((song, index) => {
        const row = document.createElement('tr');
        row.className = index === currentIndex ? 'active' : '';
        row.onclick = (e) => {
            currentIndex = index;
            loadSong(currentIndex);
            if (!isPlaying) {
                playPause();
            } else if (!song.isSpotify) {
                audio.play();
            }
        };
        
        row.oncontextmenu = (e) => {
            e.preventDefault();
            showContextMenu(e.pageX, e.pageY, index);
        };
        
        const spotifyBadge = song.isSpotify ? '<span class="spotify-badge"><i class="fab fa-spotify"></i>Spotify</span>' : '';
        const isFavorite = favorites.has(index) ? 'fas' : 'far';
        const favoriteColor = favorites.has(index) ? 'style="color: #ff4081;"' : '';
        
        row.innerHTML = `
            <td class="track-number">
                ${index === currentIndex && isPlaying ? 
                    '<div class="wave-animation"><div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div></div>' : 
                    index + 1}
            </td>
            <td class="track-title">
                <img src="${song.img}" alt="${song.name}" class="track-image">
                <div class="track-info">
                    <div class="track-name">${song.name} ${spotifyBadge}</div>
                    <div class="track-artist">${song.artist}</div>
                </div>
            </td>
            <td class="track-album">${song.album}</td>
            <td class="track-year">${song.year}</td>
            <td class="track-duration">${song.duration}</td>
            <td class="track-actions">
                <button class="action-btn" onclick="event.stopPropagation(); toggleFavorite(${index})" ${favoriteColor}>
                    <i class="${isFavorite} fa-heart"></i>
                </button>
            </td>
        `;
        
        elements.songList.appendChild(row);
    });
}

async function filterSongs(query) {
    if (query.trim() === '') {
        filteredSongs = [...playlist];
        currentIndex = 0;
        if (filteredSongs.length > 0) {
            loadSong(currentIndex);
        }
        updatePlaylist();
        return;
    }
    
    const searchTerm = query.toLowerCase();
    filteredSongs = playlist.filter(song => 
        song.name.toLowerCase().includes(searchTerm) ||
        song.artist.toLowerCase().includes(searchTerm) ||
        song.music.toLowerCase().includes(searchTerm) ||
        song.album.toLowerCase().includes(searchTerm)
    );
    
    if (isSpotifyConnected && query.length > 2) {
        const spotifyResults = await searchSpotify(query);
        spotifyResults.forEach(track => {
            filteredSongs.push({
                src: track.uri,
                img: track.album.images[0]?.url || '',
                name: track.name,
                album: track.album.name,
                year: new Date(track.album.release_date).getFullYear(),
                music: 'Spotify',
                artist: track.artists.map(a => a.name).join(', '),
                duration: `${Math.floor(track.duration_ms / 60000)}:${((track.duration_ms % 60000) / 1000).toFixed(0).padStart(2, '0')}`,
                isSpotify: true
            });
        });
    }
    
    currentIndex = 0;
    if (filteredSongs.length > 0) {
        loadSong(currentIndex);
    } else {
        showToast('No songs found', 'info');
    }
    updatePlaylist();
}

function sortSongs(type) {
    document.querySelectorAll('.sort-btn').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    
    filteredSongs.sort((a, b) => {
        if (type === 'name') return a.name.localeCompare(b.name);
        if (type === 'year') return a.year - b.year;
        if (type === 'artist') return a.artist.localeCompare(b.artist);
        if (type === 'music') return a.music.localeCompare(b.music);
        return 0;
    });
    
    updatePlaylist();
}

function toggleFavorite(index) {
    event.stopPropagation();
    const btn = event.target.closest('button');
    const icon = btn.querySelector('i');
    
    if (favorites.has(index)) {
        favorites.delete(index);
        icon.classList.remove('fas');
        icon.classList.add('far');
        icon.style.color = '';
        showToast('Removed from favorites', 'info');
    } else {
        favorites.add(index);
        icon.classList.remove('far');
        icon.classList.add('fas');
        icon.style.color = '#ff4081';
        showToast('Added to favorites', 'success');
    }
}

function showToast(message, type = 'info') {
    elements.toast.textContent = message;
    elements.toast.className = 'toast';
    
    if (type === 'success') {
        elements.toast.classList.add('success');
    } else if (type === 'error') {
        elements.toast.classList.add('error');
    }
    
    elements.toast.classList.add('show');
    
    setTimeout(() => {
        elements.toast.classList.remove('show');
    }, 3000);
}

function setupEventListeners() {
    
    audio.onended = () => {
        if (!isSpotifyConnected) {
            nextSong();
        }
    };
    
    audio.onerror = () => {
        showToast('Error loading audio file', 'error');
        isPlaying = false;
        updatePlayButton();
        elements.songImg.classList.remove('playing');
        elements.waveAnimation.style.display = 'none';
    };
    
    
    elements.spotifyConnectBtn.onclick = () => {
        if (!isSpotifyConnected) {
            connectSpotify();
        } else {
            if (confirm('Disconnect from Spotify?')) {
                disconnectSpotify();
            }
        }
    };
    
    document.getElementById('userProfile').onclick = () => {
        if (isSpotifyConnected) {
            showToast('Connected to Spotify Premium', 'success');
        } else {
            showToast('Galex Premium Music Player', 'info');
        }
    };
    
    document.addEventListener('keydown', (e) => {
        switch(e.code) {
            case 'Space':
                e.preventDefault();
                playPause();
                break;
            case 'ArrowRight':
                if (e.ctrlKey) nextSong();
                break;
            case 'ArrowLeft':
                if (e.ctrlKey) prevSong();
                break;
            case 'KeyK':
                if (e.ctrlKey) playPause();
                break;
            case 'KeyF':
                if (e.ctrlKey) toggleFavorite(currentIndex);
                break;
            case 'KeyM':
                if (e.ctrlKey) {
                    volume = volume === 0 ? 0.7 : 0;
                    audio.volume = volume;
                    elements.volumeLevel.style.width = `${volume * 100}%`;
                    showToast(volume === 0 ? 'Muted' : 'Unmuted');
                }
                break;
        }
    });
    
    setupProgressBar();

    document.addEventListener('click', hideContextMenu);
    
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            hideContextMenu();
        }
    });
}

window.addEventListener('DOMContentLoaded', initPlayer);

window.playPause = playPause;
window.prevSong = prevSong;
window.nextSong = nextSong;
window.filterSongs = filterSongs;
window.sortSongs = sortSongs;
window.connectSpotify = connectSpotify;
window.toggleFavorite = toggleFavorite;
</script>
</body>
</html>



